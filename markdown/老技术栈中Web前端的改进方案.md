# 老技术栈中, Web前端的技术改进方案

如何 `从程序员成长为技术经理` (不是CTO)

在我加入公司前(2016年初), 研发中心的技术栈属于Java6的时代.

加入公司后, 我的主要职责有2个

* 组建Web前端部门
* 让Web前端部门的工作走上正轨

这不是我第一次负责技术方案, 但是却是我第一次负责部门筹建外加技术升级.
需要认真对待了.

### 第一次技术升级

刚刚接手的时候, Web前端的状况不仅乱, 而且还无处着手.
甚至根本就没有web前端部门, 仅有的几名网页开发工程师都归属于设计部.

所以第一次的技术升级, 要解决的问题有两个

1. 需要一个团队
2. 先解决前端手头积压的工作

好在Web前端的问题, 公司领导很重视, 所以在很多方便都给了比较多的支持.
(这一点很重要, 工作中很多琐事, 如果处理不顺利, 非常影响整个部门的工作)

#### 先来解决第一个问题, 人事问题

在领导的支持下
第一步, 在公司行政规划上先成立一个新部门: Web前端.
当然这是CEO操作的, 我只是等待审核结果.

成立Web前端部门后, 我作为Web前端的技术经理和部门里的唯一员工, 
此时此刻是一个真正的"光杆司令".

第二步, 把原来归属设计部的几名网页开发人员转到Web前端.

终于人丁兴旺了. 有好几个人了, 此时面对的问题是: 老兵遇上新领导.
人事处理怎么办? 我有个敲门, 想要团结大家最好的方法还是: "真诚"

有了开发人员之后, 工作重点聚焦到下一项

#### 再解决面临的技术难题, 代码的质量底下

Web前端没有稳定/长期的规划, 可遵循的标准, 导致的问题就是

* 乱
* 散
* 多

2年多时间积累下来的, 陈年的二手代码. 
不完全统计: 6名全职网页开发 + 20多名Java + 3名PHP参与过Web前端代码编写或维护.

原来的服务采用单体服务, 前端页面由后端(Java/PHP)代码渲染生成.
在渲染过程中, 后端开发随意添加/修改HTML或者Javascript代码片段.

甚至有代码判断通过CMS后台手工录入, 再通过数据读接口取出来渲染到页面当中.
想改都不知道从何下手

各种各样的用法, 习惯, 风格混在一起正应了<相见欢>的那句: 
剪不断理还乱...别是一番滋味在心头

**解决方法**

1. 刷存在感, 技术只是铺垫, 首先要解决的是, 让公司知道Web前端部门的存在.
2. 制定工作流, 独立Web前端, 不再是设计部或者后端开发的附庸.

先说说刷存在感的事情, 为什么重要. 为什么重要呢, 就不多说了. 总之很重要.

Web前端想要独立, 关键在于代码的控制权. 软件开发过程中, 代码就是一切.

因为Web前端的代码都是通过后台渲染生成, 所以前端的代码控制权实际上在后端开发手中.

还有一个原因, Web前端曾经长期附属与设计部, 这就给产品经理留下固定印象:

* 前端就是做网页
* 做网页就是切图

由此导致了开发流程的模式是

产品 -> UI -> 切图 -> 后端开发 -> 协助后端调整样式 -> 提交测试

Web前端完全成了开发流程中的次要角色, 一点都没有存在感(存在感的重要性).

拿回代码的控制权, 就要有代码的编辑权限, 并把权限控制在Web前端的内部.
也就是说, 我们需要自己的代码库.

> 补充说明
> 在技术上做更新的时候, 不能影响现有工作. 不能顾此失彼, 所以在做技术更新之前,
> 要先清理手头上积压的工作, 把工作量缩减到可控范围内, 才能腾出人手, 做技术更新

前端要有自己的代码库! 抱着这个目标, 开始了新的工作

1. 向CTO提出, Web前端需要自己的代码库 [CTO同意]
2. 询问后端同事, 代码库的地址以及代码库的管理员 [指向运维]
3. 向运维申请新代码库权限 [邮件回复了SVN的地址和新账号]
4. 犹豫了一秒钟, 然后删掉了SVN地址和账号 [抵制SVN]
5. 向运维申请服务器 (被问: 前端要服务器做啥?) [得到一台独立虚拟服务器资源]
6. 搭建Gitlab服务
7. 创建代码库, 向Web前端部门同事分发gitlab账号
8. 技术分享讲座, 向Web前端部门同事推广git [强制使用]

... 遇到了一些变故, 有好有坏, 经过了长时间的磨合以及其它方面的努力后

9. 与安卓团队的gitlab服务合并
10. 引入CI工具, 集成jenkins与gitlab, 自动编译并发布到测试环境
11. 修改web项目的开发流程, 缩短Web前端的开发周期

... TODO

这一过程持续了很长时间, 当中也遇到了很多问题, 比如

* 向运维申请服务器资源的时候, 被问到: 前端要服务器有什么用? (前端对运维来说毫无存在感)
* git的推广难度, 对于传统的网页开发人员来说, git过于复杂, 难以操作
* Web前端和后端的耦合度依然过高, 想要进一步解耦需要对前端做大幅度的重构

为了实现这一阶段的目标, 采取的方式是:

* 清理积压工作, 腾出时间做技术升级
* 申请到硬件资源可以自己搭建辅助开发的服务
* 多次的技术分享(刷存在感)
* 独立Web前端的代码, 掌握代码的主动权(刷存在感)
* 说服其它部门的同事, 接受Web前端修改现有的开发流程(刷存在感)
* 和谐职场是个童话, 以理服人的情况很少, 大部分是靠吵架争取来的...(强刷存在感)


### 第二次技术升级

引入前端编译工具 Gulp

这一阶段的主要任务是, 独立Web前端, 成为一个单独的开发环节

难点:

1. 招聘人才的困难
2. 学习曲线的困难
3. 如何解决与原有开发流程上的冲突

为了实现这一阶段的目标, 采取的方式是:

* 创建一套新的开发模式
* 培训, 推广gulp

### 第三次技术升级

全面的/完整的 行业内目前最佳实践方案, 并且作了自定义的修改, 更符合现在的开发模型, 减少迁移痛苦

`风险决定`

**引入Webpack**

引入这个框架的时候, 冒着相当大的风险. 那时候的感觉, 自己像是在"玩火", 到底是是"玩火自焚"还是"照亮方向"并不是很有把握.

Gulp + Webpack + React + Mobx

风险点有2个

1. Webpack的引入能否平滑迁移现有项目
2. 部门内是否全部人都能够学会Webpack的开发方式

现在来看, 结果是比较乐观的.

解决方法

1. Gulp + Webpack 的架构, 并没有先例可循. 要自己摸索, 技术要求非常高. 在没有自动化测试的情况下还要保证代码的正确性
2. 给部门内的人时间, 然后相信他们. 相信他们能够顺利掌握.

这一阶段的主要任务是, 提高Web前端的质量和开发效率. 拥有和App竞争的能力

### 尾声

Web前端的发展, 并没有结束. 但是到止为止, 作为支撑公司业务的Web前端的部门已经完成. 可以把此时的部门比作一列火车, 它已经上了轨道, 开始前行.
能走多远, 拭目以待.

